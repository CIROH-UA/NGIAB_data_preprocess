<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hydro Select - Catchment Selector</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CSS + DaisyUI CDN -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <!-- MapLibre GL -->
    <script src="https://unpkg.com/maplibre-gl@^4.0.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@^4.0.0/dist/maplibre-gl.css" rel="stylesheet" />

    <!-- PMTiles -->
    <script src="https://unpkg.com/pmtiles@latest/dist/pmtiles.js"></script>

    <!-- DeckGL -->
    <script src="https://unpkg.com/deck.gl@^9.0.0/dist.min.js"></script>
    <script src="https://unpkg.com/@deck.gl/mapbox@^9.0.0/dist.min.js"></script>

    <!-- HubbleGL for video export -->
    <script src="https://unpkg.com/hubble.gl@^1.3.0/dist.min.js"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" />
  </head>

  <body class="font-[Outfit]">
    <div class="drawer lg:drawer-open h-screen">
      <input id="my-drawer-3" type="checkbox" class="drawer-toggle" />

      <!-- Main Content -->
      <main class="drawer-content flex flex-col overflow-hidden h-screen">
        <!-- Map Container -->
        <div id="map-container" class="flex-1 relative">
          <div id="map" class="h-full"></div>

          <!-- Map Controls -->
          <div class="absolute top-4 right-4 flex flex-col gap-1">
            <button class="btn btn-square btn-sm btn-neutral" id="zoom-in" title="Zoom In">
              <svg
                class="w-5 h-5"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="11" cy="11" r="8" />
                <line x1="21" y1="21" x2="16.65" y2="16.65" />
                <line x1="11" y1="8" x2="11" y2="14" />
                <line x1="8" y1="11" x2="14" y2="11" />
              </svg>
            </button>
            <button class="btn btn-square btn-sm btn-neutral" id="zoom-out" title="Zoom Out">
              <svg
                class="w-5 h-5"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="11" cy="11" r="8" />
                <line x1="21" y1="21" x2="16.65" y2="16.65" />
                <line x1="8" y1="11" x2="14" y2="11" />
              </svg>
            </button>
            <button class="btn btn-square btn-sm btn-neutral" id="reset-view" title="Reset View">
              <svg
                class="w-5 h-5"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                <path d="M3 3v5h5" />
              </svg>
            </button>
          </div>

          <!-- Tooltip -->
          <div id="tooltip" class="map-tooltip"></div>
        </div>

        <!-- Command Builder -->
        <div class="div px-6 py-4">
          <div class="flex justify-between items-center mb-3">
            <label class="swap">
              <!-- this hidden checkbox controls the state -->
              <input type="checkbox" id="cmd_checkbox" />
              <div class="swap-on join">
                <div class="join-item btn btn-sm">UVX</div>
                <div class="join-item btn btn-sm btn-primary">Pip</div>
              </div>
              <div class="swap-off join">
                <div class="join-item btn btn-sm btn-primary">UVX</div>
                <div class="join-item btn btn-sm">Pip</div>
              </div>
            </label>
            <button class="btn btn-sm btn-soft" id="copy-command">
              <svg
                class="w-3.5 h-3.5"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
              </svg>
              <span>Copy</span>
            </button>
          </div>
          <div class="bg-base-300 rounded-box py-2 px-4">
            <pre
              class="m-0 !bg-transparent"
            ><code id="cli-command" class="font-mono text-sm text-primary">Select a catchment to generate command</code></pre>
          </div>
        </div>

        <!-- Progress Section -->
        <div class="bg-base-200 border-t border-base-300 px-6 py-4 hidden" id="progress-section">
          <div class="flex justify-between items-center mb-2">
            <span class="text-sm font-medium">Processing...</span>
            <span class="font-mono text-sm text-info" id="progress-percent">0%</span>
          </div>
          <progress
            class="progress progress-info w-full"
            id="progress-fill"
            value="0"
            max="100"
          ></progress>
          <p class="text-xs text-base-content/50 mt-2" id="progress-status">Initializing...</p>
        </div>

        <!-- Output Section -->
        <div class="bg-base-200 border-t border-success px-6 py-4 hidden" id="output-section">
          <div class="flex items-center gap-2 mb-2 text-success font-medium">
            <svg
              class="w-4 h-4"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
              <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
            <span>Output</span>
          </div>
          <p class="font-mono text-sm text-base-content/70 break-all" id="output-path"></p>
        </div>

        <label for="my-drawer-3" class="btn drawer-button lg:hidden">Open drawer</label>
      </main>

      <div class="drawer-side">
        <label for="my-drawer-3" aria-label="close sidebar" class="drawer-overlay"></label>

        <!-- Sidebar -->
        <aside class="bg-base-200 w-80 flex flex-col overflow-hidden">
          <!-- Header -->
          <div class="p-6 border-b border-base-300 bg-base-300">
            <div class="flex items-center gap-4">
              <svg
                class="w-7 h-7 text-primary"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                <circle cx="12" cy="10" r="3" />
              </svg>
              <span class="text-xl font-semibold tracking-tight">Hydro Select</span>
              <label class="flex cursor-pointer gap-2">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="12" cy="12" r="5" />
                  <path
                    d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"
                  />
                </svg>
                <input
                  id="theme-toggle"
                  type="checkbox"
                  value="dark"
                  class="toggle theme-controller"
                />
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
              </label>
            </div>
          </div>

          <!-- Scrollable Content -->
          <div class="flex-1 overflow-y-auto p-4 flex flex-col gap-4">
            <!-- Map Layers Section -->
            <div class="card bg-base-300">
              <div class="card-body p-4">
                <h3
                  class="flex items-center gap-2 text-xs font-semibold uppercase tracking-wider text-base-content/60 mb-4"
                >
                  <svg
                    class="w-4 h-4 opacity-70"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6" />
                    <line x1="8" y1="2" x2="8" y2="18" />
                    <line x1="16" y1="6" x2="16" y2="22" />
                  </svg>
                  Map Layers
                </h3>
                <div class="flex flex-col gap-3">
                  <label class="flex items-center justify-between cursor-pointer">
                    <span class="text-sm text-base-content/70">USGS Gages</span>
                    <input
                      type="checkbox"
                      id="toggle-gages"
                      class="toggle toggle-sm toggle-primary"
                    />
                  </label>
                  <label class="flex items-center justify-between cursor-pointer">
                    <span class="text-sm text-base-content/70">CAMELS Basins</span>
                    <input
                      type="checkbox"
                      id="toggle-camels"
                      class="toggle toggle-sm toggle-primary"
                    />
                  </label>
                  <label class="flex items-center justify-between cursor-pointer">
                    <span class="text-sm text-base-content/70">NWM Chunks</span>
                    <input
                      type="checkbox"
                      id="toggle-nwm"
                      class="toggle toggle-sm toggle-primary"
                    />
                  </label>
                  <label class="flex items-center justify-between cursor-pointer">
                    <span class="text-sm text-base-content/70">AORC Chunks</span>
                    <input
                      type="checkbox"
                      id="toggle-aorc"
                      class="toggle toggle-sm toggle-primary"
                    />
                  </label>
                </div>
              </div>
            </div>

            <!-- Subset Mode Section -->
            <div class="card bg-base-300">
              <div class="card-body p-4">
                <h3
                  class="flex items-center gap-2 text-xs font-semibold uppercase tracking-wider text-base-content/60 mb-4"
                >
                  <svg
                    class="w-4 h-4 opacity-70"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="12" cy="12" r="10" />
                    <path d="M12 6v6l4 2" />
                  </svg>
                  Subset Mode
                </h3>
                <div class="flex flex-col gap-2">
                  <label class="flex items-center gap-3 cursor-pointer py-1">
                    <input
                      type="radio"
                      name="subset-type"
                      value="nexus"
                      checked
                      class="radio radio-sm radio-primary"
                    />
                    <span class="text-sm text-base-content/70">By Nexus</span>
                  </label>
                  <label class="flex items-center gap-3 cursor-pointer py-1">
                    <input
                      type="radio"
                      name="subset-type"
                      value="catchment"
                      class="radio radio-sm radio-primary"
                    />
                    <span class="text-sm text-base-content/70">By Catchment</span>
                  </label>
                </div>
              </div>
            </div>

            <!-- Selection Info -->
            <div class="card bg-base-300 border-l-4 border-l-primary">
              <div class="card-body p-4">
                <h3
                  class="flex items-center gap-2 text-xs font-semibold uppercase tracking-wider text-base-content/60 mb-4"
                >
                  <svg
                    class="w-4 h-4 opacity-70"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                  </svg>
                  Selection
                </h3>
                <div class="bg-base-100 rounded-box p-3 mb-3">
                  <span class="font-mono text-sm text-primary break-all" id="selected-basin"
                    >Click map to select</span
                  >
                </div>
                <div class="flex justify-between items-center pt-2 border-t border-base-content/10">
                  <span class="text-xs text-base-content/50">Upstream catchments:</span>
                  <span class="font-mono text-base font-semibold text-success" id="upstream-count"
                    >0</span
                  >
                </div>
              </div>
            </div>

            <!-- Time Range Section -->
            <div class="card bg-base-300">
              <div class="card-body p-4">
                <h3
                  class="flex items-center gap-2 text-xs font-semibold uppercase tracking-wider text-base-content/60 mb-4"
                >
                  <svg
                    class="w-4 h-4 opacity-70"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                    <line x1="16" y1="2" x2="16" y2="6" />
                    <line x1="8" y1="2" x2="8" y2="6" />
                    <line x1="3" y1="10" x2="21" y2="10" />
                  </svg>
                  Time Range
                </h3>
                <div class="flex flex-col gap-4">
                  <div class="form-control">
                    <label class="label py-1">
                      <span class="label-text text-xs font-medium uppercase tracking-wide"
                        >Start</span
                      >
                    </label>
                    <input
                      type="datetime-local"
                      id="start-time"
                      value="2010-01-01T00:00"
                      class="input input-sm input-bordered font-mono text-sm"
                    />
                  </div>
                  <div class="form-control">
                    <label class="label py-1">
                      <span class="label-text text-xs font-medium uppercase tracking-wide"
                        >End</span
                      >
                    </label>
                    <input
                      type="datetime-local"
                      id="end-time"
                      value="2010-01-02T00:00"
                      class="input input-sm input-bordered font-mono text-sm"
                    />
                  </div>
                </div>
              </div>
            </div>

            <!-- Data Source Section -->
            <div class="card bg-base-300">
              <div class="card-body p-4">
                <h3
                  class="flex items-center gap-2 text-xs font-semibold uppercase tracking-wider text-base-content/60 mb-4"
                >
                  <svg
                    class="w-4 h-4 opacity-70"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <ellipse cx="12" cy="5" rx="9" ry="3" />
                    <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" />
                    <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" />
                  </svg>
                  Data Source
                </h3>
                <div class="join w-full">
                  <button class="join-item btn btn-sm flex-1 btn-primary" data-source="nwm">
                    NWM
                  </button>
                  <button class="join-item btn btn-sm flex-1 btn-ghost" data-source="aorc">
                    AORC
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Footer -->
          <div class="p-4 border-t border-base-300 bg-base-300 flex flex-col gap-3">
            <!-- Recording Controls -->
            <div class="flex flex-col gap-3" id="recording-controls">
              <div
                class="flex items-center gap-2 px-3 py-2 bg-base-100 rounded-box"
                id="recording-status"
              >
                <span class="status-dot w-2.5 h-2.5 rounded-full bg-base-content/30"></span>
                <span class="status-text text-xs text-base-content/70">Ready to record</span>
              </div>
              <div class="grid grid-cols-2 gap-2">
                <div class="form-control">
                  <label class="label py-0.5">
                    <span class="label-text text-[10px] uppercase">Duration (sec)</span>
                  </label>
                  <input
                    type="number"
                    id="record-duration"
                    value="5"
                    min="1"
                    max="30"
                    class="input input-xs input-bordered font-mono"
                  />
                </div>
                <div class="form-control">
                  <label class="label py-0.5">
                    <span class="label-text text-[10px] uppercase">FPS</span>
                  </label>
                  <select id="record-fps" class="select select-xs select-bordered font-mono">
                    <option value="30" selected>30</option>
                    <option value="60">60</option>
                  </select>
                </div>
              </div>
              <button class="btn btn-sm btn-error" id="btn-record">
                <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                  <circle cx="12" cy="12" r="8" />
                </svg>
                Record Animation
              </button>
              <button class="btn btn-sm btn-ghost" id="btn-preview" style="display: none">
                <svg
                  class="w-4 h-4"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polygon points="5 3 19 12 5 21 5 3" />
                </svg>
                Preview
              </button>
            </div>

            <div class="divider my-0"></div>

            <!-- Action Buttons -->
            <button class="btn btn-sm btn-primary" id="btn-subset">
              <svg
                class="w-4 h-4"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="7 10 12 15 17 10" />
                <line x1="12" y1="15" x2="12" y2="3" />
              </svg>
              Create Subset
            </button>
            <button class="btn btn-sm btn-ghost" id="btn-forcings">
              <svg
                class="w-4 h-4"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"
                />
              </svg>
              Generate Forcings
            </button>
            <button class="btn btn-sm btn-ghost" id="btn-realization">
              <svg
                class="w-4 h-4"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" />
                <line x1="16" y1="13" x2="8" y2="13" />
                <line x1="16" y1="17" x2="8" y2="17" />
                <polyline points="10 9 9 9 8 9" />
              </svg>
              Create Realization
            </button>
          </div>
        </aside>
      </div>
    </div>

    <!-- Console -->
    <div
      class="hidden fixed bottom-0 right-0 w-[calc(100%-320px)] bg-base-200 border-t border-base-300 z-50 transition-transform duration-300 console-collapsed"
      id="console"
    >
      <div
        class="flex justify-between items-center px-4 py-2 bg-base-300 cursor-pointer"
        id="console-header"
      >
        <span class="text-xs font-semibold uppercase tracking-wide text-base-content/50"
          >Console</span
        >
        <button class="btn btn-xs btn-ghost btn-square" id="toggle-console">
          <svg
            class="w-4 h-4"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="18 15 12 9 6 15" />
          </svg>
        </button>
      </div>
      <div
        class="h-48 overflow-y-auto p-4 font-mono text-xs leading-relaxed text-base-content/70"
        id="console-body"
      >
        <div id="log-output" class="flex flex-col-reverse"></div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}" type="module"></script>
  </body>
</html>
