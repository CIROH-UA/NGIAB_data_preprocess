<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Catchment Selector</title>

        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link
            href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
        />

        <!-- MapLibre GL -->
        <script src="https://unpkg.com/maplibre-gl@^4.0.0/dist/maplibre-gl.js"></script>
        <link
            href="https://unpkg.com/maplibre-gl@^4.0.0/dist/maplibre-gl.css"
            rel="stylesheet"
        />

        <!-- PMTiles -->
        <script src="https://unpkg.com/pmtiles@latest/dist/pmtiles.js"></script>

        <!-- DeckGL -->
        <script src="https://unpkg.com/deck.gl@^9.0.0/dist.min.js"></script>
        <script src="https://unpkg.com/@deck.gl/mapbox@^9.0.0/dist.min.js"></script>

        <!-- HubbleGL for video export -->
        <script src="https://unpkg.com/hubble.gl@^1.3.0/dist.min.js"></script>

        <!-- Styles -->
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='css/main.css') }}"
        />
    </head>
    <body>
        <div class="app-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <div class="logo">
                        <svg
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"
                            />
                            <circle cx="12" cy="10" r="3" />
                        </svg>
                        <span>Hydro Select</span>
                    </div>
                </div>

                <div class="sidebar-content">
                    <!-- Map Layers Section -->
                    <section class="panel">
                        <h3 class="panel-title">
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <polygon
                                    points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"
                                />
                                <line x1="8" y1="2" x2="8" y2="18" />
                                <line x1="16" y1="6" x2="16" y2="22" />
                            </svg>
                            Map Layers
                        </h3>
                        <div class="toggle-group">
                            <label class="toggle">
                                <input type="checkbox" id="toggle-gages" />
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">USGS Gages</span>
                            </label>
                            <label class="toggle">
                                <input type="checkbox" id="toggle-camels" />
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">CAMELS Basins</span>
                            </label>
                            <label class="toggle">
                                <input type="checkbox" id="toggle-nwm" />
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">NWM Chunks</span>
                            </label>
                            <label class="toggle">
                                <input type="checkbox" id="toggle-aorc" />
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">AORC Chunks</span>
                            </label>
                        </div>
                    </section>

                    <!-- Subset Type Section -->
                    <section class="panel">
                        <h3 class="panel-title">
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <circle cx="12" cy="12" r="10" />
                                <path d="M12 6v6l4 2" />
                            </svg>
                            Subset Mode
                        </h3>
                        <div class="radio-group">
                            <label class="radio">
                                <input
                                    type="radio"
                                    name="subset-type"
                                    value="nexus"
                                    checked
                                />
                                <span class="radio-mark"></span>
                                <span class="radio-label">By Nexus</span>
                            </label>
                            <label class="radio">
                                <input
                                    type="radio"
                                    name="subset-type"
                                    value="catchment"
                                />
                                <span class="radio-mark"></span>
                                <span class="radio-label">By Catchment</span>
                            </label>
                        </div>
                    </section>

                    <!-- Selection Info -->
                    <section class="panel selection-panel">
                        <h3 class="panel-title">
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path
                                    d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
                                />
                            </svg>
                            Selection
                        </h3>
                        <div class="selection-display">
                            <span class="selection-value" id="selected-basin"
                                >Click map to select</span
                            >
                        </div>
                        <div class="upstream-count">
                            <span class="count-label"
                                >Upstream catchments:</span
                            >
                            <span class="count-value" id="upstream-count"
                                >0</span
                            >
                        </div>
                    </section>

                    <!-- Time Settings -->
                    <section class="panel">
                        <h3 class="panel-title">
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <rect
                                    x="3"
                                    y="4"
                                    width="18"
                                    height="18"
                                    rx="2"
                                    ry="2"
                                />
                                <line x1="16" y1="2" x2="16" y2="6" />
                                <line x1="8" y1="2" x2="8" y2="6" />
                                <line x1="3" y1="10" x2="21" y2="10" />
                            </svg>
                            Time Range
                        </h3>
                        <div class="time-inputs">
                            <div class="input-group">
                                <label for="start-time">Start</label>
                                <input
                                    type="datetime-local"
                                    id="start-time"
                                    value="2010-01-01T00:00"
                                />
                            </div>
                            <div class="input-group">
                                <label for="end-time">End</label>
                                <input
                                    type="datetime-local"
                                    id="end-time"
                                    value="2010-01-02T00:00"
                                />
                            </div>
                        </div>
                    </section>

                    <!-- Data Source -->
                    <section class="panel">
                        <h3 class="panel-title">
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <ellipse cx="12" cy="5" rx="9" ry="3" />
                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" />
                                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" />
                            </svg>
                            Data Source
                        </h3>
                        <div class="source-toggle">
                            <button class="source-btn active" data-source="nwm">
                                NWM
                            </button>
                            <button class="source-btn" data-source="aorc">
                                AORC
                            </button>
                        </div>
                    </section>
                </div>

                <div class="sidebar-footer">
                    <!-- Recording Controls -->
                    <div class="recording-controls" id="recording-controls">
                        <div class="recording-status" id="recording-status">
                            <span class="status-dot"></span>
                            <span class="status-text">Ready to record</span>
                        </div>
                        <div class="recording-settings">
                            <div class="input-group">
                                <label for="record-duration"
                                    >Duration (sec)</label
                                >
                                <input
                                    type="number"
                                    id="record-duration"
                                    value="5"
                                    min="1"
                                    max="30"
                                />
                            </div>
                            <div class="input-group">
                                <label for="record-fps">FPS</label>
                                <select id="record-fps">
                                    <option value="30" selected>30</option>
                                    <option value="60">60</option>
                                </select>
                            </div>
                        </div>
                        <button class="action-btn record-btn" id="btn-record">
                            <svg
                                viewBox="0 0 24 24"
                                fill="currentColor"
                                stroke="none"
                            >
                                <circle cx="12" cy="12" r="8" />
                            </svg>
                            Record Animation
                        </button>
                        <button
                            class="action-btn secondary"
                            id="btn-preview"
                            style="display: none"
                        >
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <polygon points="5 3 19 12 5 21 5 3" />
                            </svg>
                            Preview
                        </button>
                    </div>

                    <hr class="divider" />

                    <button class="action-btn" id="btn-subset">
                        <svg
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"
                            />
                            <polyline points="7 10 12 15 17 10" />
                            <line x1="12" y1="15" x2="12" y2="3" />
                        </svg>
                        Create Subset
                    </button>
                    <button class="action-btn secondary" id="btn-forcings">
                        <svg
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"
                            />
                        </svg>
                        Generate Forcings
                    </button>
                    <button class="action-btn secondary" id="btn-realization">
                        <svg
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                            />
                            <polyline points="14 2 14 8 20 8" />
                            <line x1="16" y1="13" x2="8" y2="13" />
                            <line x1="16" y1="17" x2="8" y2="17" />
                            <polyline points="10 9 9 9 8 9" />
                        </svg>
                        Create Realization
                    </button>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Map Container -->
                <div id="map-container">
                    <div id="map"></div>

                    <!-- Map Controls -->
                    <div class="map-controls">
                        <button class="map-ctrl" id="zoom-in" title="Zoom In">
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <circle cx="11" cy="11" r="8" />
                                <line x1="21" y1="21" x2="16.65" y2="16.65" />
                                <line x1="11" y1="8" x2="11" y2="14" />
                                <line x1="8" y1="11" x2="14" y2="11" />
                            </svg>
                        </button>
                        <button class="map-ctrl" id="zoom-out" title="Zoom Out">
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <circle cx="11" cy="11" r="8" />
                                <line x1="21" y1="21" x2="16.65" y2="16.65" />
                                <line x1="8" y1="11" x2="14" y2="11" />
                            </svg>
                        </button>
                        <button
                            class="map-ctrl"
                            id="reset-view"
                            title="Reset View"
                        >
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path
                                    d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"
                                />
                                <path d="M3 3v5h5" />
                            </svg>
                        </button>
                    </div>

                    <!-- Tooltip -->
                    <div id="tooltip" class="tooltip"></div>
                </div>

                <!-- Command Builder -->
                <div class="command-section">
                    <div class="command-header">
                        <div class="command-toggle">
                            <button class="cmd-btn active" data-cmd="uvx">
                                UVX
                            </button>
                            <button class="cmd-btn" data-cmd="pip">Pip</button>
                        </div>
                        <button class="copy-btn" id="copy-command">
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <rect
                                    x="9"
                                    y="9"
                                    width="13"
                                    height="13"
                                    rx="2"
                                    ry="2"
                                />
                                <path
                                    d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
                                />
                            </svg>
                            <span>Copy</span>
                        </button>
                    </div>
                    <pre
                        class="command-display"
                    ><code id="cli-command">Select a catchment to generate command</code></pre>
                </div>

                <!-- Progress Section -->
                <div
                    class="progress-section"
                    id="progress-section"
                    style="display: none"
                >
                    <div class="progress-header">
                        <span class="progress-title">Processing...</span>
                        <span class="progress-percent" id="progress-percent"
                            >0%</span
                        >
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <p class="progress-status" id="progress-status">
                        Initializing...
                    </p>
                </div>

                <!-- Output Section -->
                <div
                    class="output-section"
                    id="output-section"
                    style="display: none"
                >
                    <div class="output-header">
                        <svg
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                            <polyline points="22 4 12 14.01 9 11.01" />
                        </svg>
                        <span>Output</span>
                    </div>
                    <p class="output-path" id="output-path"></p>
                </div>
            </main>

            <!-- Console -->
            <div class="console" id="console">
                <div class="console-header" id="console-header">
                    <span>Console</span>
                    <button class="console-toggle" id="toggle-console">
                        <svg
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <polyline points="18 15 12 9 6 15" />
                        </svg>
                    </button>
                </div>
                <div class="console-body" id="console-body">
                    <div id="log-output"></div>
                </div>
            </div>
        </div>

        <script
            src="{{ url_for('static', filename='js/main.js') }}"
            type="module"
        ></script>
    </body>
</html>
