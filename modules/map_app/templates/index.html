<!-- templates/index.html -->
<!doctype html>
{% from "macros.html" import icon_copy, icon_clock, icon_chat, icon_calendar, icon_check,
icon_location, icon_download, icon_wrench, icon_file, icon_map_layers, icon_database,
icon_chevron_up, text_toggle, theme_toggle, sidebar_item, sidebar_heading, toggle_row,
datetime_input %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hydro Select - Catchment Selector</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
    <script src="https://unpkg.com/maplibre-gl@^4.0.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@^4.0.0/dist/maplibre-gl.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://unpkg.com/pmtiles@latest/dist/pmtiles.js"></script>
    <script src="https://unpkg.com/deck.gl@^9.0.0/dist.min.js"></script>
    <script src="https://unpkg.com/@deck.gl/mapbox@^9.0.0/dist.min.js"></script>
    <script src="https://unpkg.com/hubble.gl@^1.3.0/dist.min.js"></script>
  </head>
  <body class="font-[InterVariable]">
    <div class="drawer lg:drawer-open h-screen">
      <input id="my-drawer-3" type="checkbox" class="drawer-toggle" />

      <!-- Main Content -->
      <main class="drawer-content flex flex-col overflow-hidden h-screen">
        <!-- Map Container -->
        <div id="map-container" class="flex-1 relative">
          <div id="map" class="h-full"></div>
          <div
            id="tooltip"
            class="map-tooltip p-2 absolute shadow rounded-md backdrop-blur-sm border border-base-300 hidden"
          ></div>
        </div>

        <!-- Command Builder -->
        <div class="px-6 py-4 bg-base-100">
          <div class="flex justify-between items-center mb-3">
            {{ text_toggle(id='cmd-toggle', labels=['UVX', 'Pip'], size='sm') }}
            <button class="btn btn-sm btn-soft" id="copy-command">
              {{ icon_copy() }}
              <span>Copy</span>
            </button>
          </div>
          <div class="bg-base-300 rounded-box py-2 px-4">
            <code id="cli-command" class="font-mono text-sm"
              >Select a catchment to generate command</code
            >
          </div>
        </div>

        <!-- Progress Section -->
        <div class="bg-base-200 border-t border-base-300 px-6 py-4 hidden" id="progress-section">
          <div class="flex justify-between items-center mb-2">
            <span class="text-sm font-medium">Processing...</span>
            <span class="font-mono text-sm text-info" id="progress-percent">0%</span>
          </div>
          <progress
            class="progress progress-info w-full"
            id="progress-fill"
            value="0"
            max="100"
          ></progress>
          <p class="text-xs text-base-content/50 mt-2" id="progress-status">Initializing...</p>
        </div>

        <!-- Output Section -->
        <div class="bg-base-200 border-t border-success px-6 py-4 hidden" id="output-section">
          <div class="flex items-center gap-2 mb-2 text-success font-medium">
            {{ icon_check() }}
            <span>Output</span>
          </div>
          <p class="font-mono text-sm text-base-content/70 break-all" id="output-path"></p>
        </div>

        <label for="my-drawer-3" class="btn drawer-button lg:hidden">Open drawer</label>
      </main>

      <!-- Sidebar -->
      <div class="drawer-side">
        <label for="my-drawer-3" aria-label="close sidebar" class="drawer-overlay"></label>
        <div class="flex flex-col h-full">
          <!-- Header -->
          <div class="p-6 bg-base-300 shrink-0">
            <div class="flex items-center gap-4">
              {{ icon_location() }}
              <span class="text-xl font-semibold tracking-tight">Hydro Select</span>
              {{ theme_toggle() }}
            </div>
          </div>

          <!-- Sidebar Content -->
          <div class="flex-1 overflow-y-auto p-4 flex flex-col gap-4">
            <!-- Map Layers -->
            {% call sidebar_item() %} {% call sidebar_heading(icon=icon_map_layers()) %}Map Layers{%
            endcall %}
            <div class="flex flex-col gap-3">
              {{ toggle_row("USGS Gages", "toggle-gages") }} {{ toggle_row("CAMELS
              Basins","toggle-camels") }} {{ toggle_row("NWM Chunks", "toggle-nwm") }} {{
              toggle_row("AORC Chunks", "toggle-aorc") }}
            </div>
            {% endcall %}

            <!-- Subset Mode -->
            {% call sidebar_item() %} {% call sidebar_heading(icon=icon_clock()) %}Subset Mode{%
            endcall %} {{ text_toggle(id='subset-type-toggle', labels=['Catchment', 'Nexus'],
            tailwind="w-32") }} {% endcall %}

            <!-- Selection Info -->
            {% call sidebar_item() %} {% call sidebar_heading(icon=icon_chat()) %}Selection{%
            endcall %}
            <div class="bg-base-100 rounded-box p-3 mb-3">
              <span class="font-mono text-sm text-primary break-all" id="selected-basin"
                >Click map to select</span
              >
            </div>
            <div class="flex justify-between items-center pt-2 border-t border-base-content/10">
              <span class="text-xs text-base-content/50">Upstream catchments:</span>
              <span class="font-mono text-base font-semibold text-success" id="upstream-count"
                >0</span
              >
            </div>
            {% endcall %}

            <!-- Time Range -->
            {% call sidebar_item() %} {% call sidebar_heading(icon=icon_calendar()) %}Time Range{%
            endcall %}
            <div class="flex flex-col gap-4">
              {{ datetime_input("Start", "start-time", "2010-01-01T00:00") }} {{
              datetime_input("End", "end-time", "2010-01-02T00:00") }}
            </div>
            {% endcall %}

            <!-- Data Source -->
            {% call sidebar_item() %} {% call sidebar_heading(icon=icon_database()) %}Data Source{%
            endcall %} {{ text_toggle(id='data-source-toggle', labels=['AORC', 'NWM'],
            tailwind="w-32") }} {% endcall %}
          </div>

          <!-- Footer -->
          <div class="p-4 border border-base-300 bg-base-200 flex flex-col gap-3 shrink-0">
            <!-- Action Buttons -->
            <ul class="steps steps-vertical">
              <li class="step step-success">
                <span class="step-icon">{{ icon_download() }}</span>
                <button class="btn btn-soft shadow outline uppercase" id="btn-subset">
                  Create Subset
                </button>
              </li>
              <li class="step step-success">
                <span class="step-icon">{{ icon_wrench() }}</span>
                <button class="btn btn-soft shadow outline uppercase" id="btn-forcings">
                  Generate Forcings
                </button>
              </li>
              <li class="step">
                <span class="step-icon">{{ icon_file() }}</span>
                <button class="btn btn-soft shadow outline uppercase" id="btn-realization">
                  Create Realization
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Console -->
    <div
      class="hidden fixed bottom-0 right-0 w-[calc(100%-320px)] bg-base-200 border-t border-base-300 z-50 transition-transform duration-300 console-collapsed"
      id="console"
    >
      <div
        class="flex justify-between items-center px-4 py-2 bg-base-300 cursor-pointer"
        id="console-header"
      >
        <span class="text-xs font-semibold uppercase tracking-wide text-base-content/50"
          >Console</span
        >
        <button class="btn btn-xs btn-ghost btn-square" id="toggle-console">
          {{ icon_chevron_up() }}
        </button>
      </div>
      <div
        class="h-48 overflow-y-auto p-4 font-mono text-xs leading-relaxed text-base-content/70"
        id="console-body"
      >
        <div id="log-output" class="flex flex-col-reverse"></div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}" type="module"></script>
  </body>
</html>
